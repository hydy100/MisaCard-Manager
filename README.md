# MisaCard ç®¡ç†ç³»ç»Ÿã€æœªåšé‰´æƒï¼Œä»…æ¨èåœ¨å±€åŸŸç½‘å†…ä½¿ç”¨ã€‘

ä¸€ä¸ªåŠŸèƒ½å®Œå–„çš„è™šæ‹Ÿå¡ç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç† MisaCard è™šæ‹Ÿä¿¡ç”¨å¡ï¼Œæ”¯æŒå¡ç‰‡æ¿€æ´»ã€æŸ¥è¯¢ã€æ‰¹é‡å¯¼å…¥ã€é€€æ¬¾ç®¡ç†ç­‰åŠŸèƒ½ã€‚

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.115.5-green.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½
- **å¡ç‰‡ç®¡ç†** - å®Œæ•´çš„ CRUD æ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- **è‡ªåŠ¨æ¿€æ´»** - é›†æˆ MisaCard APIï¼Œè‡ªåŠ¨æŸ¥è¯¢å¹¶æ¿€æ´»è™šæ‹Ÿå¡
- **æ‰¹é‡å¯¼å…¥** - æ”¯æŒ TXT/JSON æ ¼å¼æ‰¹é‡å¯¼å…¥å¡å¯†
- **æ™ºèƒ½è¿‡æœŸæ£€æµ‹** - è‡ªåŠ¨æ£€æµ‹å¹¶æ ‡è®°è¿‡æœŸå¡ç‰‡
- **é€€æ¬¾ç®¡ç†** - è·Ÿè¸ªå’Œç®¡ç†å¡ç‰‡é€€æ¬¾ç”³è¯·
- **æ¶ˆè´¹è®°å½•** - æŸ¥è¯¢å¡ç‰‡äº¤æ˜“å†å²å’Œä½™é¢ä¿¡æ¯

### ğŸ¨ ç”¨æˆ·ç•Œé¢
- **ç°ä»£åŒ– Web ç•Œé¢** - åŸºäº Tailwind CSS çš„å“åº”å¼è®¾è®¡
- **å®æ—¶æ•°æ®ç»Ÿè®¡** - å¡ç‰‡çŠ¶æ€ã€é¢åº¦ã€æ¿€æ´»ç‡ç­‰æ•°æ®å¯è§†åŒ–
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡æ ‡è®°é€€æ¬¾ã€æ‰¹é‡åˆ é™¤ç­‰æ“ä½œ
- **ä¸€é”®å¤åˆ¶** - å¿«é€Ÿå¤åˆ¶å·²è¿‡æœŸæœªé€€æ¬¾å¡å·ï¼Œå¹¶å¯è‡ªåŠ¨æ ‡è®°

#### ç•Œé¢é¢„è§ˆ
![ç³»ç»Ÿæ¦‚è§ˆ](static/overview.png)
![å¡ç‰‡åˆ—è¡¨](static/list.png)

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§
- **RESTful API** - æ ‡å‡†çš„ REST API è®¾è®¡
- **å¼‚æ­¥å¤„ç†** - åŸºäº FastAPI çš„å¼‚æ­¥è¯·æ±‚å¤„ç†
- **è‡ªåŠ¨æ–‡æ¡£** - Swagger UI / ReDoc è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£
- **æ•°æ®éªŒè¯** - Pydantic æ¨¡å‹éªŒè¯
- **æ¿€æ´»æ—¥å¿—** - å®Œæ•´çš„æ¿€æ´»å†å²è®°å½•

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI 0.115.5
- **æ•°æ®åº“**: SQLite + SQLAlchemy 2.0.36 ORM
- **æœåŠ¡å™¨**: Uvicorn (ASGI)
- **æ•°æ®éªŒè¯**: Pydantic 2.10.3
- **HTTP å®¢æˆ·ç«¯**: httpx 0.28.1
- **æ¨¡æ¿å¼•æ“**: Jinja2 3.1.4
- **å‰ç«¯æ ·å¼**: Tailwind CSS

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- pip (Python åŒ…ç®¡ç†å™¨)

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Laccoliths-pro/MisaCard-Manager.git
cd backend
```

#### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# macOS/Linux:
source venv/bin/activate
# Windows:
venv\Scripts\activate
```

#### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env
```

> é»˜è®¤é…ç½®å·²åŒ…å«æ‰€æœ‰å¿…è¦å‚æ•°ï¼Œé€šå¸¸æ— éœ€ä¿®æ”¹ã€‚å¦‚éœ€è‡ªå®šä¹‰ç«¯å£æˆ–æ•°æ®åº“è·¯å¾„ï¼Œå¯ç¼–è¾‘ `.env` æ–‡ä»¶ã€‚

#### 5. åˆå§‹åŒ–æ•°æ®åº“

```bash
# åˆ›å»ºæ•°æ®åº“å’Œè¡¨
python3 init_db.py init

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
python3 init_db.py check
```

#### 6. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡è½½ï¼‰
python3 -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æˆ–ä½¿ç”¨æä¾›çš„å¯åŠ¨è„šæœ¬
chmod +x run.sh
./run.sh
```

#### 7. è®¿é—®åº”ç”¨

- **Web ç•Œé¢**: http://localhost:8000
- **API æ–‡æ¡£ (Swagger)**: http://localhost:8000/docs
- **API æ–‡æ¡£ (ReDoc)**: http://localhost:8000/redoc

## ğŸ“– ä½¿ç”¨æŒ‡å—

### Web ç•Œé¢åŠŸèƒ½

#### 1. æ¦‚è§ˆé¡µé¢
- æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡æ•°æ®ï¼ˆæœ‰æ•ˆå¡ç‰‡ã€æ¿€æ´»ç‡ã€æ€»é¢åº¦ç­‰ï¼‰
- å¿«é€Ÿè®¿é—®ä¸»è¦åŠŸèƒ½

#### 2. å¡ç‰‡åˆ—è¡¨
- æŸ¥çœ‹æ‰€æœ‰å¡ç‰‡ä¿¡æ¯
- æœç´¢å’Œç­›é€‰ï¼ˆæŒ‰çŠ¶æ€ã€é€€æ¬¾çŠ¶æ€ï¼‰
- æ‰¹é‡æ“ä½œï¼ˆæ ‡è®°é€€æ¬¾ã€åˆ é™¤ï¼‰
- **ä¸€é”®å¤åˆ¶å·²è¿‡æœŸæœªé€€æ¬¾å¡å·** - ç‚¹å‡»åå¯é€‰æ‹©è‡ªåŠ¨æ ‡è®°ä¸ºå·²ç”³è¯·é€€æ¬¾

#### 3. æŸ¥è¯¢æ¿€æ´»
- è¾“å…¥å¡å¯†è‡ªåŠ¨æŸ¥è¯¢å¹¶æ¿€æ´»
- æ˜¾ç¤ºå®Œæ•´çš„å¡ç‰‡ä¿¡æ¯

#### 4. æ‰¹é‡å¯¼å…¥
- ç²˜è´´å¡ç‰‡æ•°æ®æ‰¹é‡å¯¼å…¥
- æ”¯æŒæ ¼å¼ï¼š`å¡å¯†: mio-xxx é¢åº¦: x æœ‰æ•ˆæœŸ: xå°æ—¶`

### API ä½¿ç”¨ç¤ºä¾‹

#### åˆ›å»ºå¡ç‰‡

```bash
curl -X POST "http://localhost:8000/api/cards/" \
  -H "Content-Type: application/json" \
  -d '{
    "card_id": "mio-xxxxx-xxxxx",
    "card_nickname": "æµ‹è¯•å¡",
    "card_limit": 10.0,
    "validity_hours": 1
  }'
```

#### æ¿€æ´»å¡ç‰‡

```bash
curl -X POST "http://localhost:8000/api/cards/mio-xxxxx-xxxxx/activate"
```

#### è·å–å¡ç‰‡åˆ—è¡¨

```bash
# è·å–æ‰€æœ‰å¡ç‰‡
curl "http://localhost:8000/api/cards/"

# ç­›é€‰å·²æ¿€æ´»çš„å¡ç‰‡
curl "http://localhost:8000/api/cards/?status=active"

# ç­›é€‰å·²è¿‡æœŸçš„å¡ç‰‡
curl "http://localhost:8000/api/cards/?status=expired"

# æœç´¢å¡ç‰‡
curl "http://localhost:8000/api/cards/?search=mio-123"
```

#### å¤åˆ¶å·²è¿‡æœŸæœªé€€æ¬¾å¡å·

```bash
curl "http://localhost:8000/api/cards/batch/unreturned-card-numbers"
```

#### æŸ¥è¯¢æ¶ˆè´¹è®°å½•

```bash
curl "http://localhost:8000/api/cards/mio-xxxxx-xxxxx/transactions"
```

æ›´å¤š API è¯¦æƒ…è¯·æŸ¥çœ‹ Swagger æ–‡æ¡£ï¼šhttp://localhost:8000/docs

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py           # åº”ç”¨åˆå§‹åŒ–
â”‚   â”œâ”€â”€ main.py               # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ models.py             # SQLAlchemy æ¨¡å‹
â”‚   â”œâ”€â”€ schemas.py            # Pydantic æ¨¡å‹
â”‚   â”œâ”€â”€ crud.py               # æ•°æ®åº“ CRUD æ“ä½œ
â”‚   â”œâ”€â”€ api/                  # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ cards.py          # å¡ç‰‡ç®¡ç†æ¥å£
â”‚   â”‚   â””â”€â”€ imports.py        # æ‰¹é‡å¯¼å…¥æ¥å£
â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ activation.py     # å¡ç‰‡æ¿€æ´»é€»è¾‘
â”‚   â”‚   â””â”€â”€ parser.py         # æ–‡ä»¶è§£æ
â”‚   â”œâ”€â”€ templates/            # Jinja2 æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ index.html        # Web ç•Œé¢
â”‚   â””â”€â”€ static/               # é™æ€æ–‡ä»¶
â”œâ”€â”€ init_db.py                # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–
â”œâ”€â”€ .env.example              # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore                # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ run.sh                    # å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
```

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### Cardï¼ˆå¡ç‰‡è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| card_id | String | å¡å¯†ï¼ˆå”¯ä¸€ï¼‰ |
| card_nickname | String | å¡ç‰‡æ˜µç§° |
| card_number | String | å¡å·ï¼ˆæ¿€æ´»åï¼‰ |
| card_cvc | String | CVC å®‰å…¨ç  |
| card_exp_date | String | æœ‰æ•ˆæœŸï¼ˆMM/YYï¼‰ |
| billing_address | String | è´¦å•åœ°å€ |
| card_limit | Float | é¢åº¦ |
| validity_hours | Integer | æœ‰æ•ˆæ—¶é•¿ï¼ˆå°æ—¶ï¼‰ |
| status | String | çŠ¶æ€ï¼ˆactive/inactive/expired/deletedï¼‰ |
| is_activated | Boolean | æ˜¯å¦å·²æ¿€æ´» |
| create_time | DateTime | åˆ›å»ºæ—¶é—´ |
| card_activation_time | DateTime | æ¿€æ´»æ—¶é—´ |
| exp_date | DateTime | è¿‡æœŸæ—¶é—´ |
| refund_requested | Boolean | æ˜¯å¦ç”³è¯·é€€æ¬¾ |
| refund_requested_time | DateTime | é€€æ¬¾ç”³è¯·æ—¶é—´ |

### ActivationLogï¼ˆæ¿€æ´»æ—¥å¿—è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| card_id | String | å¡å¯† |
| status | String | æ¿€æ´»çŠ¶æ€ï¼ˆsuccess/failedï¼‰ |
| error_message | String | é”™è¯¯ä¿¡æ¯ |
| activation_time | DateTime | æ¿€æ´»æ—¶é—´ |
| response_data | String | API å“åº”æ•°æ® |

## ğŸ”§ æ•°æ®åº“ç®¡ç†

### åˆå§‹åŒ–æ•°æ®åº“

```bash
python3 init_db.py init
```

### æ£€æŸ¥æ•°æ®åº“çŠ¶æ€

```bash
python3 init_db.py check
```

### é‡ç½®æ•°æ®åº“ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰

```bash
python3 init_db.py reset
```

è¿™å°†åˆ é™¤æ‰€æœ‰æ•°æ®å¹¶é‡æ–°åˆ›å»ºè¡¨ã€‚

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„ API ç«¯ç‚¹

1. åœ¨ `app/schemas.py` ä¸­å®šä¹‰ Pydantic æ¨¡å‹
2. åœ¨ `app/crud.py` ä¸­æ·»åŠ æ•°æ®åº“æ“ä½œå‡½æ•°
3. åœ¨ `app/api/` ä¸‹åˆ›å»ºæˆ–æ›´æ–°è·¯ç”±æ–‡ä»¶
4. åœ¨ `app/main.py` ä¸­æ³¨å†Œè·¯ç”±

### ä¿®æ”¹æ•°æ®åº“æ¨¡å‹

1. æ›´æ–° `app/models.py` ä¸­çš„æ¨¡å‹å®šä¹‰
2. ä½¿ç”¨ Alembic ç”Ÿæˆè¿ç§»è„šæœ¬ï¼š
   ```bash
   alembic revision --autogenerate -m "æè¿°ä¿®æ”¹å†…å®¹"
   alembic upgrade head
   ```

### è¿è¡Œæµ‹è¯•

```bash
pytest
```

## ğŸ“ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•°æ®åº“æ–‡ä»¶ `cards.db` ä½äºé¡¹ç›®æ ¹ç›®å½•ã€‚ä½ å¯ä»¥åœ¨ `.env` æ–‡ä»¶ä¸­ä¿®æ”¹ `DATABASE_URL` æ¥æ›´æ”¹ä½ç½®ã€‚

### 2. ç«¯å£ 8000 å·²è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

åœ¨ `.env` æ–‡ä»¶ä¸­ä¿®æ”¹ `PORT` é…ç½®ï¼Œæˆ–å¯åŠ¨æ—¶æŒ‡å®šç«¯å£ï¼š
```bash
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8888
```

### 3. æ—¶åŒºé—®é¢˜

ç³»ç»Ÿä½¿ç”¨ UTC æ—¶é—´å­˜å‚¨ï¼Œå‰ç«¯ä¼šæ ¹æ®æµè§ˆå™¨æ—¶åŒºè‡ªåŠ¨è½¬æ¢æ˜¾ç¤ºã€‚å¦‚æœå‘ç°æ—¶é—´ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥ï¼š
- ç¡®ä¿ç³»ç»Ÿæ—¶é—´æ­£ç¡®
- MisaCard API è¿”å›çš„æ—¶é—´æ ¼å¼ï¼ˆé»˜è®¤ä¸º UTC+8ï¼‰

### 4. å¤åˆ¶åŠŸèƒ½ä¸å·¥ä½œ

å¤åˆ¶åŠŸèƒ½éœ€è¦æµè§ˆå™¨æ”¯æŒ Clipboard APIï¼Œæˆ–åœ¨ HTTPS ç¯å¢ƒä¸‹è¿è¡Œã€‚æœ¬åœ°å¼€å‘æ—¶ localhost é»˜è®¤æ˜¯å®‰å…¨ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§ä½¿ç”¨ä¼ ç»Ÿçš„å¤åˆ¶æ–¹æ³•ã€‚

### 5. "å·²è¿‡æœŸ+æœªç”³è¯·é€€æ¬¾"ç­›é€‰ä¸åˆ°æ•°æ®

è¯·ç¡®ä¿ï¼š
1. åç«¯å·²é‡å¯ï¼Œæ—¶åŒºä¿®å¤å·²ç”Ÿæ•ˆ
2. æ•°æ®åº“ä¸­çš„ `exp_date` å­—æ®µå·²æ­£ç¡®è®¾ç½®
3. åˆ·æ–°é¡µé¢åé‡æ–°ç­›é€‰

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ä¸è¦æäº¤ .env æ–‡ä»¶åˆ° Git** - .gitignore å·²é…ç½®å¿½ç•¥æ­¤æ–‡ä»¶
2. **æ•°æ®åº“å¤‡ä»½** - å®šæœŸå¤‡ä»½ `cards.db` æ•°æ®åº“æ–‡ä»¶ï¼Œé¿å…æ•°æ®ä¸¢å¤±
3. **ç”Ÿäº§ç¯å¢ƒé…ç½®** - ç”Ÿäº§ç¯å¢ƒå»ºè®®ï¼š
   - è®¾ç½® `DEBUG=false`
   - ä½¿ç”¨æ›´å®‰å…¨çš„æ•°æ®åº“ï¼ˆPostgreSQL/MySQLï¼‰
   - é…ç½® HTTPS
   - é™åˆ¶ CORS æ¥æº
   - æ·»åŠ èº«ä»½éªŒè¯

## ğŸ“œ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ GitHub Issueã€‚

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼
